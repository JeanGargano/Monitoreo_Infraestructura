<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editar Producto</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding-top: 80px;
            padding-bottom: 40px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .navbar {
            background: rgba(255, 255, 255, 0.95) !important;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .navbar-brand {
            font-weight: bold;
            font-size: 1.5rem;
            color: #667eea !important;
        }
        
        .content-card {
            background: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            max-width: 700px;
            margin: 0 auto;
        }
        
        h2 {
            color: #333;
            font-weight: bold;
            margin-bottom: 30px;
        }
        
        .btn-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            transition: all 0.3s ease;
        }
        
        .btn-gradient:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
            color: white;
        }
        
        .btn-back {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
            transition: all 0.3s ease;
        }
        
        .btn-back:hover {
            background: #667eea;
            color: white;
        }
    </style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top">
    <div class="container">
        <a class="navbar-brand" href="/">
            <i class="fas fa-box-open"></i> Gestión de Productos
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <a class="nav-link" href="/">
                        <i class="fas fa-home"></i> Inicio
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/productos">
                        <i class="fas fa-list"></i> Productos
                    </a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div class="container">
    <div class="content-card">
        <h2><i class="fas fa-edit"></i> Editar Producto</h2>
        
        <a href="/productos" class="btn btn-back mb-4">
            <i class="fas fa-arrow-left"></i> Volver a Productos
        </a>

        <form id="edit-producto-form" onsubmit="event.preventDefault(); updateProducto();">
            <input type="hidden" id="producto-id" value="">
            
            <div class="form-group">
                <label for="nombre">Nombre del Producto</label>
                <input type="text" class="form-control" id="nombre" required>
            </div>

            <div class="form-group">
                <label for="descripcion">Descripción</label>
                <textarea class="form-control" id="descripcion" rows="3" required></textarea>
            </div>

            <div class="form-row">
                <div class="form-group col-md-4">
                    <label for="precio">Precio ($)</label>
                    <input type="number" step="0.01" class="form-control" id="precio" required>
                </div>

                <div class="form-group col-md-4">
                    <label for="cantidad">Cantidad en Stock</label>
                    <input type="number" class="form-control" id="cantidad" required>
                </div>

                <div class="form-group col-md-4">
                    <label for="categoria">Categoría</label>
                    <input type="text" class="form-control" id="categoria" required>
                </div>
            </div>

            <button type="submit" class="btn btn-gradient btn-block">
                <i class="fas fa-save"></i> Guardar Cambios
            </button>
        </form>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="{{ url_for('static', filename='productos.js') }}"></script>

<script>
    const params = new URLSearchParams(window.location.search);
    const productId = params.get("id");

    if (!productId) {
        console.error("No se encontró el ID del producto en la URL.");
        alert("Error: No se ha especificado el ID del producto.");
        window.location.href = "/productos";
    } else {
        // Cargar datos del producto
        fetch(`/api/productos/${productId}`)
            .then(response => {
                if (!response.ok) throw new Error("Error al obtener los datos del producto");
                return response.json();
            })
            .then(data => {
                document.getElementById('producto-id').value = data.id;
                document.getElementById('nombre').value = data.nombre;
                document.getElementById('descripcion').value = data.descripcion;
                document.getElementById('precio').value = data.precio;
                document.getElementById('cantidad').value = data.cantidad;
                document.getElementById('categoria').value = data.categoria;
            })
            .catch(error => {
                console.error("Error cargando producto:", error);
                alert("Error al cargar los datos del producto.");
                window.location.href = "/productos";
            });
    }
</script>

</body>
</html>